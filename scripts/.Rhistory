geom_sf(data = erco, aes(color = scientificName))+
theme_bw()
erco <- st_intersection(erco, montrose_buffer)
erco <- erco %>%
mutate(binomial =  if_else(scientificName == 'Eriogonum coloradense', 'Eriogonum coloradense', 'Eriogonum lonchophyllum'))
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = binomial)) +
theme_bw()
asde_utm <- st_transform(asde, 32613)
neighborhood_object <- spdep::dnearneigh(asde_utm, d1 = 1, d2 = 1000)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
my_list <- Map(cbind, neighs, rowNum = names(neighs))
my_list <- my_list %>%
purrr::map(., as_tibble)
ab <- data.table::rbindlist(my_list)
View(ab)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
neighs <- Map(cbind, neighs, rowNum = names(neighs))
neighs <- neighs %>%
purrr::map(., as_tibble)
ab <- data.table::rbindlist(neighs)
names(neighs) <- c('Neighbor', 'Row')
View(neighs)
library(tidyverse)
library(sf)
library(here)
sub <- '/data/raw/'
asde_path <- paste0(here(), '/Astragalus_debequaeus', sub)
erco_path <- paste0(here(), '/Eriogonum_coloradense', sub)
asde_files <- paste0(asde_path,
list.files(asde_path,
recursive = T,
pattern = "occurrences.csv$"))
erco_files <- paste0(erco_path,
list.files(erco_path,
recursive = T,
pattern = "occurrences.csv$" ))
asde <- do.call(rbind, lapply(asde_files, function(x) read.csv(x, stringsAsFactors = F)))
erco <- do.call(rbind, lapply(erco_files, function(x) read.csv(x, stringsAsFactors = F)))
rm(asde_path, erco_path, asde_files, erco_files, sub)
asde <- asde[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude)%>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
erco <- erco[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude) %>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
sf::sf_use_s2(FALSE)
asde <- st_as_sf(asde, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(decimalLongitude <= -100) %>% # Siplivinsky 3345 - needs re located
filter(!recordNumber %in% c(3345, 13279))  # E. Neese 13279
erco <- st_as_sf(erco, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(recordNumber != 26918)
montrose <- data.frame('Y' = 38.4776, 'X' = -107.8763, 'LOCATION' = 'Montrose') %>%
st_as_sf(coords = c("X", "Y"), crs = 4326)
montrose_buffer <- montrose %>%
st_transform(32613) %>%
st_buffer(240000) %>% # 150 miles
st_transform(4326)
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = asde, aes(color = scientificName)) +
theme_bw()
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = scientificName))+
theme_bw()
erco <- st_intersection(erco, montrose_buffer)
erco <- erco %>%
mutate(binomial =  if_else(scientificName == 'Eriogonum coloradense', 'Eriogonum coloradense', 'Eriogonum lonchophyllum'))
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = binomial)) +
theme_bw()
asde_utm <- st_transform(asde, 32613)
neighborhood_object <- spdep::dnearneigh(asde_utm, d1 = 1, d2 = 1000)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
neighs <- Map(cbind, neighs, rowNum = names(neighs))
neighs <- neighs %>%
purrr::map(., as_tibble)
neighs <- data.table::rbindlist(neighs)
names(neighs) <- c('Neighbor', 'Row')
View(neighs)
asde_utm <- asde_utm %>%
mutate('Row_id' = c(1:length(neighs)))
asde_utm <- asde_utm %>%
mutate('Row_id' = 1:length(neighs)))
asde_utm <- asde_utm %>%
mutate('Row_id' = 1:length(neighs))
asde_utm <- asde_utm %>%
mutate('Row_id' = 1:length(.))
asde_utm <- asde_utm %>%
mutate('Row_id' = 1:ncol(.))
asde_utm <- asde_utm %>%
mutate('Row_id' = 1:ncol(asde_utm))
asde_utm <- asde_utm %>%
mutate('Row_id' = 1:nrow(asde_utm))
asde_utm <- asde_utm %>%
mutate('Row_id' = c(1:nrow(asde_utm)))
asde_utm <- asde_utm %>%
mutate('Row_id' = rownames_to_column())
asde_utm <- asde_utm %>%
mutate('Row_id' = rownames_to_column(asde_utm))
asde_utm <- asde_utm %>%
rownames_to_column(asde_utm))
asde_utm <- asde_utm %>%
rownames_to_column(asde_utm)
View(asde)
View(asde_utm)
asde_utm <- asde_utm %>%
rownames_to_column(asde_utm)
asde_utm <- asde_utm %>%
rownames_to_column(.)
View(asde_utm)
asde_utm <- asde_utm %>%
rownames_to_column()
library(tidyverse)
library(sf)
library(here)
sub <- '/data/raw/'
asde_path <- paste0(here(), '/Astragalus_debequaeus', sub)
erco_path <- paste0(here(), '/Eriogonum_coloradense', sub)
asde_files <- paste0(asde_path,
list.files(asde_path,
recursive = T,
pattern = "occurrences.csv$"))
erco_files <- paste0(erco_path,
list.files(erco_path,
recursive = T,
pattern = "occurrences.csv$" ))
asde <- do.call(rbind, lapply(asde_files, function(x) read.csv(x, stringsAsFactors = F)))
erco <- do.call(rbind, lapply(erco_files, function(x) read.csv(x, stringsAsFactors = F)))
rm(asde_path, erco_path, asde_files, erco_files, sub)
asde <- asde[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude)%>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
erco <- erco[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude) %>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
sf::sf_use_s2(FALSE)
asde <- st_as_sf(asde, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(decimalLongitude <= -100) %>% # Siplivinsky 3345 - needs re located
filter(!recordNumber %in% c(3345, 13279))  # E. Neese 13279
erco <- st_as_sf(erco, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(recordNumber != 26918)
montrose <- data.frame('Y' = 38.4776, 'X' = -107.8763, 'LOCATION' = 'Montrose') %>%
st_as_sf(coords = c("X", "Y"), crs = 4326)
montrose_buffer <- montrose %>%
st_transform(32613) %>%
st_buffer(240000) %>% # 150 miles
st_transform(4326)
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = asde, aes(color = scientificName)) +
theme_bw()
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = scientificName))+
theme_bw()
erco <- st_intersection(erco, montrose_buffer)
erco <- erco %>%
mutate(binomial =  if_else(scientificName == 'Eriogonum coloradense', 'Eriogonum coloradense', 'Eriogonum lonchophyllum'))
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = binomial)) +
theme_bw()
asde_utm <- st_transform(asde, 32613)
neighborhood_object <- spdep::dnearneigh(asde_utm, d1 = 1, d2 = 1000)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
neighs <- Map(cbind, neighs, rowNum = names(neighs))
neighs <- neighs %>%
purrr::map(., as_tibble)
neighs <- data.table::rbindlist(neighs)
names(neighs) <- c('Neighbor', 'Row')
asde_utm <- asde_utm %>%
rownames_to_column()
View(asde_utm)
View(asde_utm)
asde_utm <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(Year, rowname)
library(tidyverse)
library(sf)
library(here)
sub <- '/data/raw/'
asde_path <- paste0(here(), '/Astragalus_debequaeus', sub)
erco_path <- paste0(here(), '/Eriogonum_coloradense', sub)
asde_files <- paste0(asde_path,
list.files(asde_path,
recursive = T,
pattern = "occurrences.csv$"))
erco_files <- paste0(erco_path,
list.files(erco_path,
recursive = T,
pattern = "occurrences.csv$" ))
asde <- do.call(rbind, lapply(asde_files, function(x) read.csv(x, stringsAsFactors = F)))
erco <- do.call(rbind, lapply(erco_files, function(x) read.csv(x, stringsAsFactors = F)))
rm(asde_path, erco_path, asde_files, erco_files, sub)
asde <- asde[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude)%>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
erco <- erco[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude) %>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
sf::sf_use_s2(FALSE)
asde <- st_as_sf(asde, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(decimalLongitude <= -100) %>% # Siplivinsky 3345 - needs re located
filter(!recordNumber %in% c(3345, 13279))  # E. Neese 13279
erco <- st_as_sf(erco, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(recordNumber != 26918)
montrose <- data.frame('Y' = 38.4776, 'X' = -107.8763, 'LOCATION' = 'Montrose') %>%
st_as_sf(coords = c("X", "Y"), crs = 4326)
montrose_buffer <- montrose %>%
st_transform(32613) %>%
st_buffer(240000) %>% # 150 miles
st_transform(4326)
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = asde, aes(color = scientificName)) +
theme_bw()
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = scientificName))+
theme_bw()
erco <- st_intersection(erco, montrose_buffer)
erco <- erco %>%
mutate(binomial =  if_else(scientificName == 'Eriogonum coloradense', 'Eriogonum coloradense', 'Eriogonum lonchophyllum'))
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = binomial)) +
theme_bw()
asde_utm <- st_transform(asde, 32613)
neighborhood_object <- spdep::dnearneigh(asde_utm, d1 = 1, d2 = 1000)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
neighs <- Map(cbind, neighs, rowNum = names(neighs))
neighs <- neighs %>%
purrr::map(., as_tibble)
neighs <- data.table::rbindlist(neighs)
names(neighs) <- c('Neighbor', 'Row')
asde_utm <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(Year, rowname)
asde_utm <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(year, rowname)
View(asde_utm)
asde_utm <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(year, rowname) %>%
left_join(., neighs)
library(tidyverse)
library(sf)
library(here)
sub <- '/data/raw/'
asde_path <- paste0(here(), '/Astragalus_debequaeus', sub)
erco_path <- paste0(here(), '/Eriogonum_coloradense', sub)
asde_files <- paste0(asde_path,
list.files(asde_path,
recursive = T,
pattern = "occurrences.csv$"))
erco_files <- paste0(erco_path,
list.files(erco_path,
recursive = T,
pattern = "occurrences.csv$" ))
asde <- do.call(rbind, lapply(asde_files, function(x) read.csv(x, stringsAsFactors = F)))
erco <- do.call(rbind, lapply(erco_files, function(x) read.csv(x, stringsAsFactors = F)))
rm(asde_path, erco_path, asde_files, erco_files, sub)
asde <- asde[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude)%>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
erco <- erco[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude) %>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
sf::sf_use_s2(FALSE)
asde <- st_as_sf(asde, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(decimalLongitude <= -100) %>% # Siplivinsky 3345 - needs re located
filter(!recordNumber %in% c(3345, 13279))  # E. Neese 13279
erco <- st_as_sf(erco, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(recordNumber != 26918)
montrose <- data.frame('Y' = 38.4776, 'X' = -107.8763, 'LOCATION' = 'Montrose') %>%
st_as_sf(coords = c("X", "Y"), crs = 4326)
montrose_buffer <- montrose %>%
st_transform(32613) %>%
st_buffer(240000) %>% # 150 miles
st_transform(4326)
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = asde, aes(color = scientificName)) +
theme_bw()
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = scientificName))+
theme_bw()
erco <- st_intersection(erco, montrose_buffer)
erco <- erco %>%
mutate(binomial =  if_else(scientificName == 'Eriogonum coloradense', 'Eriogonum coloradense', 'Eriogonum lonchophyllum'))
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = binomial)) +
theme_bw()
asde_utm <- st_transform(asde, 32613)
neighborhood_object <- spdep::dnearneigh(asde_utm, d1 = 1, d2 = 1000)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
neighs <- Map(cbind, neighs, rowNum = names(neighs))
neighs <- neighs %>%
purrr::map(., as_tibble)
neighs <- data.table::rbindlist(neighs)
names(neighs) <- c('Neighbor', 'Row')
asde_utm_1 <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(year, rowname) %>%
left_join(., neighs)
asde_utm_1 <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(year, rowname) %>%
left_join(., neighs, by = c('rowname' = 'Row'))
View(asde_utm_1)
asde_utm_2 %>%
group_by(rowname) %>%
arrange(year)
asde_utm_1 %>%
group_by(rowname) %>%
arrange(year)
a <- asde_utm_1 %>%
group_by(rowname) %>%
arrange(year)
View(a)
a <- asde_utm_1 %>%
group_by(rowname) %>%
arrange(rowname, year)
View(a)
library(tidyverse)
library(sf)
library(here)
sub <- '/data/raw/'
asde_path <- paste0(here(), '/Astragalus_debequaeus', sub)
erco_path <- paste0(here(), '/Eriogonum_coloradense', sub)
asde_files <- paste0(asde_path,
list.files(asde_path,
recursive = T,
pattern = "occurrences.csv$"))
erco_files <- paste0(erco_path,
list.files(erco_path,
recursive = T,
pattern = "occurrences.csv$" ))
asde <- do.call(rbind, lapply(asde_files, function(x) read.csv(x, stringsAsFactors = F)))
erco <- do.call(rbind, lapply(erco_files, function(x) read.csv(x, stringsAsFactors = F)))
rm(asde_path, erco_path, asde_files, erco_files, sub)
asde <- asde[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude, year)%>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
erco <- erco[,c(1:2,4,7,14:17, 24, 31:38, 68:70, 73:78, 91)] %>%
mutate(across(everything(), ~na_if(., ""))) %>%
drop_na(decimalLatitude, year) %>%
group_by(recordedBy, recordNumber, eventDate) %>%
distinct(.keep_all = T)
sf::sf_use_s2(FALSE)
asde <- st_as_sf(asde, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(decimalLongitude <= -100) %>% # Siplivinsky 3345 - needs re located
filter(!recordNumber %in% c(3345, 13279))  # E. Neese 13279
erco <- st_as_sf(erco, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326, remove = F) %>%
filter(recordNumber != 26918)
montrose <- data.frame('Y' = 38.4776, 'X' = -107.8763, 'LOCATION' = 'Montrose') %>%
st_as_sf(coords = c("X", "Y"), crs = 4326)
montrose_buffer <- montrose %>%
st_transform(32613) %>%
st_buffer(240000) %>% # 150 miles
st_transform(4326)
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = asde, aes(color = scientificName)) +
theme_bw()
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = scientificName))+
theme_bw()
erco <- st_intersection(erco, montrose_buffer)
erco <- erco %>%
mutate(binomial =  if_else(scientificName == 'Eriogonum coloradense', 'Eriogonum coloradense', 'Eriogonum lonchophyllum'))
ggplot() +
geom_sf(data = montrose_buffer, fill = 'yellow')  +
geom_sf(data = montrose) +
geom_sf(data = erco, aes(color = binomial)) +
theme_bw()
asde_utm <- st_transform(asde, 32613)
neighborhood_object <- spdep::dnearneigh(asde_utm, d1 = 1, d2 = 1000)
neighs <- neighborhood_object
neighs <- as.list(neighs)
names(neighs) <- c(1:length(neighs))
neighs <- Map(cbind, neighs, rowNum = names(neighs))
neighs <- neighs %>%
purrr::map(., as_tibble)
neighs <- data.table::rbindlist(neighs)
names(neighs) <- c('Neighbor', 'Row')
asde_utm_1 <- asde_utm %>%
rownames_to_column() %>%
dplyr::select(year, rowname) %>%
left_join(., neighs, by = c('rowname' = 'Row'))
View(asde_utm_1)
plants <- read.csv("./spatial_lecture_data/Solidago_Erigeron_Lanphere.csv") %>%
st_as_sf(coords = c(y = 'longitude', x ='latitude'), crs = 4269)  %>%
st_transform(32610) %>%
distinct(individual, .keep_all = T)
dat1 <- plants %>%
mutate(longitude = unlist(map(plants$geometry,1)),
latitude = unlist(map(plants$geometry,2))) %>%
st_drop_geometry() %>%
dplyr::select(-taxon)
View(dat1)
neighborhood_object <- dnearneigh(plants, d1 = 1, d2 = 200) # identify neighbors
dat1 <- plants %>%
mutate(longitude = unlist(map(plants$geometry,1)),
latitude = unlist(map(plants$geometry,2))) %>%
st_drop_geometry() %>%
dplyr::select(-taxon)
neighborhood_object <- dnearneigh(plants, d1 = 1, d2 = 200) # identify neighbors
shhh(library(spdep))
shhh <- suppressPackageStartupMessages #  silence messages.
shhh(library(spdep))
rm(shhh)
neighborhood_object <- dnearneigh(plants, d1 = 1, d2 = 200) # identify neighbors
summary(neighborhood_object)
links <- neighborhood_object %>%
purrr::map(., as.integer) %>%
purrr::map(., as_tibble) %>%
map2_df(plants$individual,~mutate(.x,Focal_id=.y)) %>%
rename(Neighbor = value) %>%
left_join(., dat1, by = c('Focal_id' = 'individual')) %>%
rename(longitude.id = longitude,
latitude.id = latitude) %>%
left_join(., dat1, by = c('Neighbor' = 'individual')) %>%
rename(longitude.nb = longitude,
latitude.nb = latitude)  %>%
drop_na() %>%
mutate(Link = as.numeric(paste0(Focal_id, Neighbor)))
View(links)
links <- as.matrix(links)
for (i in 1:nrow(links)){
ex_linestring[[i]] <- rbind(
c(links[i, 3], links[i, 4]),
c(links[i, 5], links[i, 6]),
c(links[i, 3], links[i, 4])
)
}
ex_linestring <- list(0)
for (i in 1:nrow(links)){
ex_linestring[[i]] <- rbind(
c(links[i, 3], links[i, 4]),
c(links[i, 5], links[i, 6]),
c(links[i, 3], links[i, 4])
)
}
ex_linestring <- lapply(ex_linestring, st_linestring)
link_collection <- ex_linestring %>%
st_sfc(crs = 32610) %>%
st_sf(geometry = .)
link_collection <-  link_collection %>%
mutate(length = as.numeric(st_length(link_collection))) %>%
filter(length >= 1 & length <= 200)
ggplot() +
geom_sf(data = link_collection, color = "lightblue2") +
geom_sf(data = plants, color = "darkorchid3", size = 1.5) +
coord_sf(ylim = c(4527046, 4527830), xlim = c(403150,403700)) +
labs(title = "Neighbors within 200 meters") +
theme_light() +
theme(plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, vjust = 0.5))
